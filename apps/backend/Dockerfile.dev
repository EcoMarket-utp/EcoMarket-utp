# Dockerfile para desarrollo del backend
FROM node:18-alpine

WORKDIR /app

# Usar npm para instalaciones en este Dockerfile de desarrollo para evitar
# complicaciones con workspaces/pnpm lockfile ubicados en el root.
RUN corepack disable || true

# Copiar package.json del backend (estamos construyendo desde el contexto raíz)
COPY apps/backend/package*.json ./
COPY pnpm-lock.yaml ./

# Instalar dependencias con npm (incluye devDeps para permitir prisma generate)
RUN npm install

# Copiar código fuente del backend
COPY apps/backend .

# Generar cliente de Prisma
RUN npx prisma generate

# Exponer puerto de desarrollo
EXPOSE 3000

# Comando de desarrollo
CMD ["npm", "run", "start:dev"]